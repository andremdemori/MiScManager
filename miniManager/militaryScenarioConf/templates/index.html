{% extends 'base.html' %}
{% load static %}

{% block content %}
  <div class="container">
    <h1>Scenario</h1>

    <form class="test-plan-form" method="POST" onsubmit="return validateForm();">
      {% csrf_token %}
      <div class="test-plan-inputs">
        <div class="row">
          <div class="col">
            <label for="scenario_name" class="form-label">Name of Scenario</label>
            <input type="text" class="form-control" id="scenario_name" name="scenario_name" placeholder="Scenario x" required>
            <label for="scenario_description" class="form-label">Description</label>
            <input type="text" class="form-control" id="scenario_description" name="scenario_description" placeholder="Description of scenario x" required>
          </div>
        </div>

        <hr>

        <div class="row">
          <div class="col">
            <h3>Military Organizations</h3>
            <div id="military-organizations-container">
              <!-- Existing military organizations will be shown here -->
            </div>
            <button type="button" class="btn btn-secondary" onclick="addMilitaryOrganization()">Add Military Organization</button>
          </div>
        </div>

        <hr>

        <div class="row">
          <div class="col">
            <h3>Military Persons</h3>
            <div id="military-persons-container">
              <!-- Existing military persons will be shown here -->
            </div>
            <button type="button" class="btn btn-secondary" onclick="addMilitaryPerson()">Add Military Person</button>
          </div>
        </div>

        <hr>

        <button type="submit" class="btn btn-secondary">Save Scenario</button>
        {% if error %}
          <div id="status-bar" class="btn btn-secondary" role="alert">{{ errorMessage }}</div>
        {% endif %}
      </div>
    </form>

  </div>

  <script>
    let militaryOrganizations = [];
    let militaryPersons = [];

    function addMilitaryOrganization() {
      const name = prompt("Enter the name of the military organization:");
      const commander = militaryOrganizations.length === 0 ? "" : prompt("Enter the name of the commander of the military organization:");
      const type = prompt("Enter the type of the military organization:");

      if (name && type) {
        if (militaryOrganizations.length > 0 && !isCommanderValid(commander)) {
          alert("The commander you entered is not valid. Please select a commander from the list.");
          return;
        }

        militaryOrganizations.push({ name, commander, type });
        renderMilitaryOrganizations();
      }
    }

    function isCommanderValid(commander) {
      return militaryOrganizations.some((militaryOrganization) => militaryOrganization.name === commander);
    }

    function addMilitaryPerson() {
      const identifier = prompt("Enter the identifier of the military person:");
      const organization = selectMilitaryOrganization();
      const carrier = selectCarrier();

      if (identifier && organization && carrier) {
        militaryPersons.push({ identifier, organization, carrier });
        renderMilitaryPersons();
      }
    }

    function selectMilitaryOrganization() {
      const organizations = militaryOrganizations.map((militaryOrganization) => militaryOrganization.name);
      const selected = prompt("Select the military organization:", organizations.join(", "));

      if (selected) {
        const militaryOrganization = militaryOrganizations.find((militaryOrganization) => militaryOrganization.name === selected);
        return militaryOrganization.name;
      }
    }

    function selectCarrier() {
      const carriers = ["Air", "Land", "Sea"];
      const selected = prompt("Select the carrier:", carriers.join(", "));

      if (selected) {
        return selected;
      }
    }

    function renderMilitaryOrganizations() {
      const militaryOrganizationsContainer = document.getElementById("military-organizations-container");
      militaryOrganizationsContainer.innerHTML = "";

      militaryOrganizations.forEach((militaryOrganization) => {
        const militaryOrganizationContainer = document.createElement("div");
        militaryOrganizationContainer.className = "military-organization-container";

        const militaryOrganizationName = document.createElement("p");
        militaryOrganizationName.innerHTML = `<b>Name:</b> ${militaryOrganization.name}`;
        militaryOrganizationContainer.appendChild(militaryOrganizationName);

        const militaryOrganizationCommander = document.createElement("p");
        militaryOrganizationCommander.innerHTML = `<b>Commander:</b> ${militaryOrganization.commander}`;
        militaryOrganizationContainer.appendChild(militaryOrganizationCommander);

        const militaryOrganizationType = document.createElement("p");
        militaryOrganizationType.innerHTML = `<b>Type:</b> ${militaryOrganization.type}`;
        militaryOrganizationContainer.appendChild(militaryOrganizationType);

        militaryOrganizationsContainer.appendChild(militaryOrganizationContainer);
      });
    }

    function renderMilitaryPersons() {
      const militaryPersonsContainer = document.getElementById("military-persons-container");
      militaryPersonsContainer.innerHTML = "";

      militaryPersons.forEach((militaryPerson) => {
        const militaryPersonContainer = document.createElement("div");
        militaryPersonContainer.className = "military-person-container";

        const militaryPersonIdentifier = document.createElement("p");
        militaryPersonIdentifier.innerHTML = `<b>Identifier:</b> ${militaryPerson.identifier}`;
        militaryPersonContainer.appendChild(militaryPersonIdentifier);

        const militaryPersonOrganization = document.createElement("p");
        militaryPersonOrganization.innerHTML = `<b>Organization:</b> ${militaryPerson.organization}`;
        militaryPersonContainer.appendChild(militaryPersonOrganization);

        const militaryPersonCarrier = document.createElement("p");
        militaryPersonCarrier.innerHTML = `<b>Carrier:</b> ${militaryPerson.carrier}`;
        militaryPersonContainer.appendChild(militaryPersonCarrier);

        militaryPersonsContainer.appendChild(militaryPersonContainer);
      });
    }

    function validateForm() {
      if (militaryOrganizations.length === 0) {
        alert("Please add at least one military organization.");
        return false;
      }

      if (militaryPersons.length === 0) {
        alert("Please add at least one military person.");
        return false;
      }

      return true;
    }

    renderMilitaryOrganizations();
    renderMilitaryPersons();
  </script>
{% endblock %}